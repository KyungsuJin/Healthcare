<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cafe24.kyungsu93.bloodpressure.service.BloodPressureMapper">
		<select id="searchDate" 
				resultType="hashmap" 
				parameterType="com.cafe24.kyungsu93.bloodpressure.service.BloodPressure">
			SELECT
			*
			FROM blood_pressure
			WHERE blood_pressure_no = #{bloodPressureNo}
			AND blood_pressure_date >= #{from_date} AND #{to_date} >= blood_pressure_date 
			ORDER BY blood_pressure_no DESC
		</select>
		<select id="searchTable" 
				resultType="hashmap" 
				parameterType="com.cafe24.kyungsu93.bloodpressure.service.BloodPressure">
			SELECT
			blood_pressure_no as bloodPressureNo,
			systolic_blood_pressure as systolicBloodPressure,
			relaxer_blood_pressure as relaxerBloodPressure,
			blood_pressure_date as bloodPressureDate,
			member_id as memberId,
			member_name as memberName
			FROM blood_pressure
			INNER JOIN member b
			ON a.member_no = b.member_no
			<where>
				<choose>
					<when test="searchType == 'relaxerBloodPressure'">
					AND relaxer_blood_pressure as relaxerBloodPressure like CONCAT('%', #{searchValue} , '%')
					</when>
					<when test="searchType == 'systolicBloodPressure'">
					AND systolic_blood_pressure as systolicBloodPressure like CONCAT('%', #{searchValue} , '%')
					</when>
				</choose>
			</where>
		</select>	
		<select id="bloodPressurechart"
			 parameterType="String"
			resultType="com.cafe24.kyungsu93.bloodpressure.service.BloodPressure">
		SELECT
			blood_pressure_no as bloodPressureNo,
			systolic_blood_pressure as systolicBloodPressure,
			relaxer_blood_pressure as relaxerBloodPressure,
			blood_pressure_date as bloodPressureDate,
			member_id as memberId,
			member_name as memberName
			FROM blood_pressure a		
			INNER JOIN member b
			ON a.member_no = b.member_no
		WHERE member_id = #{memberId}
	 </select>
	 	 <select id="bloodPressureOne"
			 parameterType="String"
			resultType="com.cafe24.kyungsu93.bloodpressure.service.BloodPressure">
		SELECT
			blood_pressure_no as bloodPressureNo,
			systolic_blood_pressure as systolicBloodPressure,
			relaxer_blood_pressure as relaxerBloodPressure,
			blood_pressure_date as bloodPressureDate,
			member_id as memberId,
			member_name as memberName
			FROM blood_pressure a		
			INNER JOIN member b
			ON a.member_no = b.member_no
		WHERE blood_pressure_no = #{bloodPressureNo}
	 </select>
	 <update id="updateBloodPressure" parameterType="com.cafe24.kyungsu93.bloodpressure.service.BloodPressure">
		UPDATE blood_pressure
		SET
			systolic_blood_pressure= #{systolicBloodPressure},
			relaxer_blood_pressure= #{relaxerBloodPressure},
			blood_pressure_date = now()
		WHERE blood_pressure_no = #{bloodPressureNo}
	</update>
	<delete id="deleteBloodPressure"  parameterType="com.cafe24.kyungsu93.bloodpressure.service.BloodPressure">
		DELETE FROM blood_pressure WHERE blood_pressure_no = #{bloodPressureNo}
	</delete>
	<select id="bloodPressureList" 
			parameterType="Integer" 
			resultType="com.cafe24.kyungsu93.bloodpressure.service.BloodPressure">
		SELECT
			blood_pressure_no as bloodPressureNo,
			systolic_blood_pressure as systolicBloodPressure,
			relaxer_blood_pressure as relaxerBloodPressure,
			blood_pressure_date as bloodPressureDate,
			member_id as memberId,
			member_name as memberName
			FROM blood_pressure a		
			INNER JOIN member b
			ON a.member_no = b.member_no
			ORDER BY blood_pressure_date DESC
			LIMIT #{beginRow},#{pagePerRow}
	</select>
 	<select id="BloodPressureId" resultType="Integer">
		SELECT
		max(CAST(substring(blood_pressure_no,16) AS DECIMAL))
		FROM blood_pressure
	</select>
	<select id="bloodPressureCount" resultType="Integer">
		SELECT
		count(*)
		FROM blood_pressure
	</select>
	<insert id="addBloodPressure" 
			parameterType="com.cafe24.kyungsu93.bloodpressure.service.BloodPressure">
	 	INSERT INTO blood_pressure (
			blood_pressure_no, member_No, systolic_blood_pressure, relaxer_blood_pressure, blood_pressure_date
			)
			VALUES (
			#{bloodPressureNo}, #{memberNo}, #{systolicBloodPressure}, #{relaxerBloodPressure}, now()
			)
	</insert> 
</mapper>
