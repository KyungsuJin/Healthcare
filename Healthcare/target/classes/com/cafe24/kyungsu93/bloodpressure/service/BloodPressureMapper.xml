<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cafe24.kyungsu93.bloodpressure.service.BloodPressureMapper">
		<select id="bloodPressureSearchCount" resultType="Integer">
			SELECT
			count(*)
			FROM blood_pressure
		<include refid="search"></include>
		</select>
 		<select id="bloodPressureSearchAll" parameterType="map" resultType="com.cafe24.kyungsu93.bloodpressure.service.BloodPressure">
      	 SELECT
			blood_pressure_no as bloodPressureNo,
			member_no as memberNo,
			systolic_pressure as systolicPressure,
			diastolic_pressure as diastolicPressure,
			blood_pressure_date as bloodPressureDate
			FROM blood_pressure  		
			<include refid="search"></include>
			ORDER BY blood_pressure_date DESC
			LIMIT #{beginRow},#{pagePerRow}
		</select>
		<select id="bloodPressureSearchDate" parameterType="map" resultType="com.cafe24.kyungsu93.bloodpressure.service.BloodPressure">
      	 SELECT
			blood_pressure_no as bloodPressureNo,
			member_no as memberNo,
			systolic_pressure as systolicPressure,
			diastolic_pressure as diastolicPressure,
			blood_pressure_date as bloodPressureDate
			FROM blood_pressure  		
			<![CDATA[
			WHERE blood_pressure_date >= #{startDate} and blood_pressure_date < #{endDate}
			]]>
			ORDER BY blood_pressure_date DESC
		</select>
		<sql id="search">
			<choose>
				<when test="keyField == 'systolicPressure'"> 
					WHERE systolic_pressure like CONCAT(#{keyWord}, '%') 
				</when> 
				<when test="keyField == 'systolicPressure'"> 
					WHERE diastolic_pressure like CONCAT(#{keyWord} , '%') 
				</when> 
			</choose> 
		</sql>
		<select id="bloodPressurechart"
			 parameterType="String"
			resultType="com.cafe24.kyungsu93.bloodpressure.service.BloodPressure">
		SELECT 
			systolic_pressure as systolicPressure,
			diastolic_pressure as diastolicPressure,
			blood_pressure_date as bloodPressureDate
		FROM blood_pressure
		WHERE member_no = #{memberNo}
		AND blood_pressure_date > (NOW() - INTERVAL 7 DAY)
		ORDER BY blood_pressure_date ASC
	 </select>
	 	 <select id="bloodPressureOne"
			 parameterType="String"
			resultType="com.cafe24.kyungsu93.bloodpressure.service.BloodPressure">
		SELECT
			blood_pressure_no as bloodPressureNo,
			systolic_pressure as systolicPressure,
			diastolic_pressure as diastolicPressure,
			blood_pressure_date as bloodPressureDate
			FROM blood_pressure 		
		WHERE blood_pressure_no = #{bloodPressureNo}
	 </select>
	 <update id="updateBloodPressure" parameterType="com.cafe24.kyungsu93.bloodpressure.service.BloodPressure">
		UPDATE blood_pressure
		SET
			systolic_pressure= #{systolicPressure},
			diastolic_pressure= #{diastolicPressure},
			blood_pressure_date = now()
		WHERE blood_pressure_no = #{bloodPressureNo}
	</update>
	<delete id="deleteBloodPressure"  parameterType="com.cafe24.kyungsu93.bloodpressure.service.BloodPressure">
		DELETE FROM blood_pressure WHERE blood_pressure_no = #{bloodPressureNo}
	</delete>
	<select id="bloodPressureList" 
			parameterType="Integer" 
			resultType="com.cafe24.kyungsu93.bloodpressure.service.BloodPressure">
		SELECT
			blood_pressure_no as bloodPressureNo,
			member_no as memberNo,
			systolic_pressure as systolicPressure,
			diastolic_pressure as diastolicPressure,
			blood_pressure_date as bloodPressureDate
			FROM blood_pressure 		
			ORDER BY blood_pressure_date DESC
			LIMIT #{beginRow},#{pagePerRow}
	</select>
 	<select id="BloodPressureId" resultType="Integer">
		SELECT
		max(CAST(substring(blood_pressure_no,16) AS DECIMAL))
		FROM blood_pressure
	</select>
	<select id="bloodPressureCount" resultType="Integer">
		SELECT
		count(*)
		FROM blood_pressure
	</select>
	<insert id="addBloodPressure" 
			parameterType="com.cafe24.kyungsu93.bloodpressure.service.BloodPressure">
	 	INSERT INTO blood_pressure (
			blood_pressure_no, member_No, systolic_pressure, diastolic_pressure, blood_pressure_date
			)
			VALUES (
			#{bloodPressureNo}, #{memberNo}, #{systolicPressure}, #{diastolicPressure}, now()
			)
	</insert> 
</mapper>
