<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.cafe24.kyungsu93.ExerciseMapper">
  	<!--보증금 등록여부 체크  -->
  	<select id="exerciseDepositChk"
  			parameterType="String"
  			resultType="Integer">
  		SELECT count(*)
  		FROM exercise_matching_member
  		WHERE member_no =#{memberNo};
  	</select>
  	<!--회원 포인트 체크  -->
  	<select id="memberPointChk"
  			parameterType="String"
  			resultType="Integer">
  		SELECT count(*)
  		FROM member
  		WHERE member_no=#{memberNo} AND member_point>=1000;
  	</select>
  	<!-- 보증금 등록 번호 -->
  	<select id="registrationNo"
  			resultType="Integer">
  			SELECT
         	IFNULL(MAX(cast(SUBSTRING(exercise_matching_member_no,14) as decimal)), 0)
         	FROM exercise_matching_member
  	</select>
  	<!-- 보증금 등록 -->
  	<insert id="depositRegistration"
  			parameterType="com.cafe24.kyungsu93.exercise.service.Exercise">
  			INSERT INTO exercise_matching_member(
  				exercise_matching_member_no
  				,member_no
  				,exercise_matching_member_date
  			)VALUES(
  				#{registrationNo}
  				,#{memberNo}
  				,now()
  			)
  	</insert>
  	<!-- 포인트 차감 -->
  	<update id="pointDeduction"
  			parameterType="String">
  			UPDATE member 
  			SET member_point = member_point-1000
			WHERE member_no =#{memberNo}
  	</update>
  	<!-- 운동매칭 게시글 번호 -->
  	<select id="exerciseMatchingNo"
  			resultType="Integer">
  			SELECT
         	IFNULL(MAX(cast(SUBSTRING(exercise_matching_no,19) as decimal)), 0)
         	FROM exercise_matching
  	</select>
  	<!-- 운동매칭 등록 -->
  	<insert id="addExerciseMatching"
  			parameterType="com.cafe24.kyungsu93.exercise.service.ExerciseRegistration">
  			INSERT INTO exercise_matching(
  				exercise_matching_no
  				,member_no
  				,exercise_no
  				,exercise_matching_title
  				,exercise_matching_content
  				,exercise_matching_time
  				,exercise_matching_count
  				,exercise_matching_place
  				,exercise_matching_schedule_date
  				,exercise_matching_date
  			)VALUES(
  				#{exerciseMatchingNo}
  				,#{memberNo}
  				,#{exerciseNo}
  				,#{exerciseMatchingTitle}
  				,#{exerciseMatchingContent}
  				,#{exerciseMatchingTime}
  				,#{exerciseMatchingCount}
  				,#{exerciseMatchingPlace}
  				,#{exerciseMatchingScheduleDate}
  				,now()
  			)
  	</insert>
  	<!-- 운동매칭 리스트 -->
  	<select id="exerciseMatchingList"
  			parameterType="java.util.Map"
  			resultType="com.cafe24.kyungsu93.exercise.service.ExerciseRegistration">
  			SELECT
				exercise.exercise_matching_no AS exerciseMatchingNo
				,member.member_id AS memberId
				,exercise.exercise_no AS exerciseNo
				,exercise.exercise_matching_title AS exerciseMatchingTitle
				,exercise.exercise_matching_content AS exerciseMatchingContent
				,exercise.exercise_matching_time AS exerciseMatchingTime
				,exercise.exercise_matching_count AS exerciseMatchingCount
				,exercise.exercise_matching_place AS exerciseMatchingPlace
				,exercise.exercise_matching_schedule_date AS exerciseMatchingScheduleDate
				,exercise.exercise_matching_date AS exerciseMatchingDate
			FROM exercise_matching AS exercise ,member 
			WHERE member.member_no = exercise.member_no
			ORDER BY exerciseMatchingNo
			LIMIT #{beginRow},#{pagePerRow}
  	</select>
  	<!-- 운동매칭 리스트 카운트 -->
  	<select id="totalCountList"
  			resultType="Integer">
  			SELECT COUNT(*)
  			FROM exercise_matching
  	</select>
  	<!-- 운동매칭 내용 출력 -->
  	<select id="exerciseMatchingContent"
  			resultType="com.cafe24.kyungsu93.exercise.service.ExerciseRegistration">
  			SELECT
				exercise.exercise_matching_no AS exerciseMatchingNo
				,member.member_id AS memberId
				,exercise.exercise_no AS exerciseNo
				,exercise.exercise_matching_title AS exerciseMatchingTitle
				,exercise.exercise_matching_content AS exerciseMatchingContent
				,exercise.exercise_matching_time AS exerciseMatchingTime
				,exercise.exercise_matching_count AS exerciseMatchingCount
				,exercise.exercise_matching_place AS exerciseMatchingPlace
				,exercise.exercise_matching_schedule_date AS exerciseMatchingScheduleDate
				,exercise.exercise_matching_date AS exerciseMatchingDate
			FROM exercise_matching AS exercise ,member 
			WHERE member.member_no = exercise.member_no AND exercise.exercise_matching_no=#{exerciseMatchingNo}
  	</select>
  	<!-- 운동매칭 글, 내용 삭제  -->
  	<delete id="deleteExerciseMatching"
  			parameterType="String">
  			DELETE FROM exercise_matching
  			WHERE exercise_matching_no =#{exerciseMatchingNo}
  			
  	</delete>
  	<!-- 운동매칭 글 수정 -->
  	<update id="modifyExerciseMatching"
  			parameterType="com.cafe24.kyungsu93.exercise.service.ExerciseRegistration">
  			UPDATE exercise_matching
  			SET
  				exercise_no=#{exerciseNo}
  				,exercise_matching_title=#{exerciseMatchingTitle}
  				,exercise_matching_content =#{exerciseMatchingContent}
  				,exercise_matching_time = #{exerciseMatchingTime}
  				,exercise_matching_count=#{exerciseMatchingCount}
  				,exercise_matching_place=#{exerciseMatchingPlace}
  				,exercise_matching_schedule_date=#{exerciseMatchingScheduleDate}
  			WHERE exercise_matching_no=#{exerciseMatchingNo}
  	</update>
  	
  </mapper>