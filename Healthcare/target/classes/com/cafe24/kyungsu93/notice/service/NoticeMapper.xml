<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cafe24.kyungsu93.notice.service.NoticeMapper">

	<select id="noticeList" parameterType="java.util.Map"
		resultType="com.cafe24.kyungsu93.notice.service.Notice">
		SELECT
		notice_no AS noticeNo
		,member_no AS memberNo
		,notice_title AS noticeTitle
		,notice_content AS noticeContent
		,notice_count AS noticeCount
		,notice_date AS noticeDate
		FROM notice

	</select>

	<select id="noticeCount" resultType="Integer">
		SELECT
		count(*)
		FROM notice
	</select>

	<insert id="addnotice"
		parameterType="com.cafe24.kyungsu93.notice.service.Notice">

		INSERT INTO notice(
		notice_no
		, member_no
		, notice_title
		, notice_content
		, notice_count
		, notice_date
		)
		VALUES (
		#{noticeNo}
		, #{memberNo}
		, #{noticeTitle}
		, #{noticeContent}
		, #{noticeCount}
		, now()
		)

	</insert>

	<select id="noticeOne" parameterType="String"
		resultType="com.cafe24.kyungsu93.notice.service.Notice">
		SELECT
		notice_no as noticeNo
		,n.member_no as memberNo
		,notice_title as noticeTitle
		,notice_content as noticeContent
		,notice_count as noticeCount
		,notice_date as noticeDate
		FROM notice AS n
		INNER JOIN member AS m
		ON n.member_no = m.member_no
		WHERE notice_no = #{noticeNo}

	</select>
	<update id="updateNotice"
		parameterType="com.cafe24.kyungsu93.notice.service.Notice">
		UPDATE notice
		SET
		notice_no = #{noticeNo}
		,member_no = #{memberNo}
		,notice_title = #{noticeTitle}
		,notice_content = #{noticeContent}
		,notice_count = #{noticeCount}
		,notice_date = now()
		WHERE notice_no = #{noticeNo}

	</update>

	<delete id="deletenotice"
		parameterType="com.cafe24.kyungsu93.notice.service.Notice">
		DELETE FROM notice WHERE notice_no = #{noticeNo}
	</delete>

	<select id="noticeSearchCount" resultType="Integer">
			SELECT
			count(*)
			FROM notice
		<include refid="search"></include>
		</select>
	<select id="noticeSearchAll" parameterType="map" resultType="com.cafe24.kyungsu93.notice.service.Notice">
      	 SELECT
			notice_no as noticeNo
			,member_no as memberNo
			,notice_title as noticeTitle
			,notice_content as noticeContent
			,notice_count as noticeCount
			,notice_date as noticeDate
			FROM notice  		
			<include refid="search"></include>
			ORDER BY notice_date DESC
			LIMIT #{beginRow},#{pagePerRow}
	</select>
	<select id="noticeSearchDate" parameterType="map" resultType="com.cafe24.kyungsu93.notice.service.Notice">
      	  SELECT
			notice_no as noticeNo
			,member_no as memberNo
			,notice_title as noticeTitle
			,notice_content as noticeContent
			,notice_count as noticeCount
			,notice_date as noticeDate
			FROM notice  		
			<![CDATA[
			WHERE notice_date >= #{startDate} and notice_date <= #{endDate}
			]]>
			ORDER BY notice_no DESC
	</select>
		<sql id="search">
			<choose>
				<when test="keyField == 'noticeTitle'"> 
					WHERE notice_title like CONCAT(#{keyWord}, '%') 
				</when> 
				<when test="keyField == 'noticeContent'"> 
					WHERE notice_content like CONCAT(#{keyWord} , '%') 
				</when> 
			</choose> 
		</sql>
		
		<update id="noticeCountView" parameterType="String">
        UPDATE notice
              SET noticeCount = noticeCount + 1 
         WHERE notice_no = #{noticeNo}
		</update>

	<select id="noticeListDetail" parameterType="java.util.Map"
			resultType="com.cafe24.kyungsu93.notice.service.Notice">
			SELECT
			notice_no AS noticeNo
			,member_no AS memberNo
			,notice_title AS noticeTitle
			,notice_content AS noticeContent
			,notice_count AS noticeCount
			,notice_date AS noticeDate
			FROM notice

	</select>

	<select id="noticeDetailCount" resultType="Integer">
			SELECT
			count(*)
			FROM notice
	</select>



	<!-- <select id="selectNoticeList" parameterType="java.util.Map" resultMap="notice">
		SELECT
		notice_no,
		,member_no,
		,notice_title,
		,notice_content,
		,notice_count,
		,notice_date
		FROM notice
		order by notice_no DESC
		limit #{beginRow},#{pagePerRow}
	</select>

	<select id="totalCountNotice" resultType="Integer">
		SELECT
		count(*)
		FROM notice

	</select>
	 -->
</mapper>